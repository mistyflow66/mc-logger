<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éº¥å¡Šå†’éšª</title>
  
  <link rel="apple-touch-icon" href="https://meee.com.tw/x9oTG9x.png">
  <link rel="icon" type="image/png" href="https://meee.com.tw/x9oTG9x.png">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    :root { --mc-green: #388E3C; --mc-dirt: #795548; --mc-stone: #424242; }
    body { font-family: 'Segoe UI', sans-serif; background: #2c2c2c; color: white; padding: 15px; text-align: center; margin:0; }
    .container { background: #3c3c3c; border: 4px solid #000; padding: 20px; border-radius: 4px; max-width: 400px; margin: auto; }
    h2 { color: #8bc34a; text-shadow: 2px 2px #000; margin: 10px 0; }
    
    .dashboard { background: #000; border: 4px solid #555; padding: 15px; margin-bottom: 15px; }
    .balance-value { color: #00e676; font-size: 32px; font-weight: bold; font-family: 'Courier New', monospace; }
    
    .user-select { background: #4e4e4e; border: 2px solid #000; padding: 10px; margin-bottom: 15px; display: flex; justify-content: space-around; align-items: center; }
    .radio-group { cursor: pointer; display: flex; align-items: center; }
    .radio-group input { width: auto; margin-right: 5px; }

    label { display: block; text-align: left; margin: 10px 0 5px; font-weight: bold; color: #bbb; }
    select, input { width: 100%; padding: 12px; margin-bottom: 10px; border: 3px solid #000; background: #fff; box-sizing: border-box; font-size: 16px; color: #000; }
    
    button { width: 100%; padding: 15px; background: var(--mc-green); color: white; border: 3px solid #1b5e20; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 4px #1b5e20; }
    button:active { transform: translateY(2px); box-shadow: 0 2px #1b5e20; }

    .daily-log { background: #252525; border: 2px solid #555; padding: 10px; margin-top: 15px; text-align: left; }
    .log-title { border-bottom:1px solid #555; font-weight:bold; color: #ffeb3b; margin-bottom: 5px; }
    .stars { font-size: 16px; color: #ffeb3b; text-align: left; background: #4e4e4e; padding: 10px; border: 2px solid #000; margin-bottom: 15px; }
    
    .score-table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 13px; color: #fff; }
    .score-table td, .score-table th { border: 1px solid #555; padding: 6px; text-align: center; }
    .score-table th { background: #795548; }

    #timer { font-size: 12px; color: #aaa; margin-top: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ’ å†’éšªå„€è¡¨æ¿</h2>
    <div id="timer">è¼‰å…¥æ™‚é–“ä¸­...</div>

    <div class="dashboard">
      <div style="color:#fff; font-size:14px;">ğŸ”‹ ç›®å‰ 3C èƒ½é‡</div>
      <div class="balance-value" id="balanceDisplay">0</div>
    </div>

    <div class="stars">
      <div id="wakeupStars">è‡ªå·±èµ·åºŠ: ----------</div>
      <div id="goodStars">GOOD: ----------</div>
    </div>

    <div class="user-select">
      <span>è§’è‰²:</span>
      <label class="radio-group"><input type="radio" name="user" value="å‰" checked onclick="switchUser('å‰')"> å‰</label>
      <label class="radio-group"><input type="radio" name="user" value="å§" onclick="switchUser('å§')"> å§</label>
    </div>

    <div id="passwordArea" class="hidden">
      <input type="password" id="passwordInput" placeholder="è¼¸å…¥å¯†ç¢¼">
    </div>

    <form id="questForm">
      <select id="typeSelect" onchange="updateItems()" required></select>
      <select id="itemSelect" required></select>
      <div id="valueArea">
        <input type="number" id="valueInput" placeholder="æ•¸é‡/åˆ†æ•¸">
      </div>
      <input type="text" id="noteInput"> 
      <button type="button" onclick="submitForm()" style="margin-top:10px;">ğŸ’¾ å­˜æª”ç´€éŒ„</button>
    </form>

    <div id="giftArea" class="hidden" style="margin-top:20px; background:#000; border:3px dashed #ffeb3b; padding:10px;">
      <div style="color:#ffeb3b; margin-bottom:10px;">ğŸ ç™¼ç¾æ‰è½ç‰©ï¼</div>
      <img id="luckyGif" src="" style="width:100%; border-radius:8px;">
    </div>

    <div id="chestSection" style="margin-top:10px; text-align:left;">
      <div style="cursor:pointer; color:#55efc4; font-size:14px;" onclick="toggleChest()">ğŸ“¦ æˆ‘çš„å¯¶ç®± (é»é–‹ç›¸ç°¿)</div>
      <div id="chestGallery" class="hidden" style="display:flex; flex-wrap:wrap; gap:5px; background:#1e1e1e; padding:10px; margin-top:5px; border-radius:5px;"></div>
    </div>
    
    <div class="daily-log">
      <div class="log-title">ğŸ“… ä»Šå¤©çš„æ—¥èªŒ</div>
      <div id="todayList" style="color:#8bc34a; font-size: 14px;"></div>
    </div>

    <div class="daily-log" style="border-color: #fab1a0;">
      <div class="log-title" style="color: #ff7675;">ğŸ“¢ æ‚„æ‚„è©±ç•™è¨€æ¿</div>
      <div id="noteList" style="font-size: 13px; color: #dfe6e9;"></div>
    </div>

    <div class="daily-log">
      <div class="log-title">ğŸ•°ï¸ æœ€è¿‘ 10 ç­†ç´€éŒ„</div>
      <div id="historyList" style="font-size: 12px; color: #bbb;"></div>
    </div>

    <div class="daily-log" style="border-color: #8bc34a;">
      <div class="log-title" style="color: #8bc34a;">ğŸ“Š é‹å‹•èˆ‡çå‹µè¨ˆåˆ†</div>
      <table class="score-table">
        <thead>
          <tr><th>é …ç›®</th><th>åŸºæº–å–®ä½</th><th>çå‹µ (3Cèƒ½é‡)</th></tr>
        </thead>
        <tbody>
          <tr><td>è·³ç¹©</td><td>100 ä¸‹</td><td>+ 5 åˆ†</td></tr>
          <tr><td>è·‘æ­¥</td><td>200 å…¬å°º</td><td>+ 5 åˆ†</td></tr>
          <tr><td>ä»°è‡¥èµ·å</td><td>1 åˆ†é˜</td><td>+ 5 åˆ†</td></tr>
          <tr><td>è‡ªå·±èµ·åºŠ</td><td>æ»¿ 10 æ¬¡</td><td>+ 5 åˆ†</td></tr>
          <tr><td>GOOD</td><td>æ»¿ 10 å€‹</td><td>+ 10 åˆ†</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const gasUrl = "https://script.google.com/macros/s/AKfycby8MaeORmgHynbc4qTnjUUCyn12NWZYJP6HEhCZ1wEsXOX3fnTlQT-LP9l8FRNQf4cG/exec"; 
    const openingDate = new Date("2026-02-23");
    const slogans = ["ä»Šå¤©çš„å¿ƒæƒ…...", "ä½ ç´¯äº†å—ï¼Ÿ", "é‚„åœ¨ã„Šã„Ÿ", "æƒ³è·Ÿå¤§å§èªªçš„è©±...", "å¯«é»å‚™è¨»..."];
    const optionsMap = {
      "å‰": { "é‹å‹•": ["è·³ç¹©", "è·‘æ­¥", "ä»°è‡¥èµ·å"], "3C": ["çœ‹é›»è¦–", "ç”¨æ‰‹æ©Ÿ", "ç©é›»è…¦"], "è¦åŠƒ": ["é–±è®€", "åšå°æ›¸", "ç·´ç¿’è‹±æ–‡", "å…¶ä»–"] },
      "å§": { "é‹å‹•": ["è·³ç¹©", "è·‘æ­¥", "ä»°è‡¥èµ·å"], "3C": ["çœ‹é›»è¦–", "ç”¨æ‰‹æ©Ÿ", "ç©é›»è…¦"], "çå‹µ": ["è‡ªå·±èµ·åºŠ", "GOOD", "åŠ åˆ†", "æ‰£åˆ†"] }
    };

    window.onload = function() {
      switchUser('å‰');
      refreshData();
      setInterval(updateTimer, 1000);
      document.getElementById('noteInput').placeholder = slogans[Math.floor(Math.random() * slogans.length)];
    };

    function updateTimer() {
      const now = new Date();
      const diff = openingDate - now;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      document.getElementById('timer').innerText = `æ›´æ–°æ™‚é–“ï¼š${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')} è·é›¢é–‹å­¸é‚„æœ‰ ${days} å¤©`;
    }

    function switchUser(user) {
      document.getElementById('passwordArea').className = (user === 'å§') ? '' : 'hidden';
      const typeSelect = document.getElementById('typeSelect');
      typeSelect.innerHTML = '<option value="">-- é¸æ“‡é¡åˆ¥ --</option>';
      Object.keys(optionsMap[user]).forEach(t => typeSelect.add(new Option(t, t)));
      updateItems();
    }

    function updateItems() {
      const user = document.querySelector('input[name="user"]:checked').value;
      const type = document.getElementById('typeSelect').value;
      const itemSelect = document.getElementById('itemSelect');
      itemSelect.innerHTML = '<option value="">-- é¸æ“‡é …ç›® --</option>';
      if (optionsMap[user][type]) {
        optionsMap[user][type].forEach(i => itemSelect.add(new Option(i, i)));
      }
    }

    function refreshData() {
      fetch(`${gasUrl}?action=readData`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('balanceDisplay').innerText = data.total3C;
          document.getElementById('wakeupStars').innerText = "è‡ªå·±èµ·åºŠ: " + "â­".repeat(data.wakeup) + "-".repeat(10-data.wakeup);
          document.getElementById('goodStars').innerText = "GOOD: " + "â™¥ï¸".repeat(data.good) + "-".repeat(10-data.good);
          document.getElementById('todayList').innerHTML = data.todayLogs.join("<br>") + `<br><b>-ä»Šæ—¥ç´¯ç©çš„3Cèƒ½é‡ï¼šğŸ”‹${data.today3Csum}-</b>`;
          document.getElementById('noteList').innerHTML = data.notes.join("<br>");
          document.getElementById('historyList').innerHTML = data.last10.join("<br>");
          
          const gallery = document.getElementById('chestGallery');
          gallery.innerHTML = "";
          if (data.myChest && data.myChest.length > 0) {
            data.myChest.forEach(url => {
              gallery.innerHTML += `<img src="${url}" style="width:60px; height:60px; object-fit:cover; border:1px solid #555; border-radius:4px;">`;
            });
          } else {
            gallery.innerHTML = "<span style='color:#777; font-size:12px;'>ç›®å‰é‚„æ²’æœ‰å¯¶è—å–”...</span>";
          }
        });
    }

    function toggleChest() {
      document.getElementById('chestGallery').classList.toggle('hidden');
    }

    function submitForm() {
      const user = document.querySelector('input[name="user"]:checked').value;
      if (user === 'å§' && document.getElementById('passwordInput').value !== "3672") {
        alert("å¯†ç¢¼éŒ¯èª¤ï¼"); return;
      }

      const type = document.getElementById('typeSelect').value;
      const item = document.getElementById('itemSelect').value;
      const val = document.getElementById('valueInput').value || 0;
      const note = document.getElementById('noteInput').value;

      if(!type || !item) { alert("é …ç›®è¦å¡«å®Œæ•´å–”ï¼"); return; }

      const url = `${gasUrl}?action=addData&user=${user}&category=${type}&item=${item}&value=${val}&note=${note}`;
      
      fetch(url).then(res => res.text()).then(giftUrl => {
        if (user === "å‰" && giftUrl && giftUrl !== "Error") {
          document.getElementById('giftArea').classList.remove('hidden');
          document.getElementById('luckyGif').src = giftUrl;
          alert("å¤ªæ£’äº†ï¼ç™¼ç¾ä¸€å€‹æ‰è½ç‰©ï¼");
          refreshData(); // éœæ…‹æ›´æ–°å¯¶ç®±
        } else {
          alert("å­˜æª”æˆåŠŸï¼");
          location.reload();
        }
      });
    }
  </script>
</body>
</html>
